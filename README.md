# ğŸ¢ é«˜å¹¶å‘å®æ—¶é¢„å®šç³»ç»Ÿ

> åŸºäº React + MobX + Material-UI æ„å»ºçš„å‰ç«¯å¹¶å‘å¤„ç†è§£å†³æ–¹æ¡ˆ

[![æ„å»ºçŠ¶æ€](https://img.shields.io/badge/build-passing-brightgreen.svg)]()
[![TypeScript](https://img.shields.io/badge/TypeScript-007ACC.svg)]()
[![React](https://img.shields.io/badge/React-61DAFB.svg)]()

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ğŸ“– æ ¸å¿ƒæ–‡æ¡£

| æ–‡æ¡£ | æè¿° |
|------|------|
| **[README.md](./README.md)** | é¡¹ç›®ç´¢å¼•å’Œå¿«é€Ÿå¼€å§‹(æœ¬æ–‡ä»¶) |


### ğŸ¯ å¿«é€Ÿè·³è½¬

- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) - å®‰è£…å’Œè¿è¡ŒæŒ‡å—
- [æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§) - ç³»ç»Ÿä¸»è¦åŠŸèƒ½
- [é¡¹ç›®æ¶æ„](#-é¡¹ç›®æ¶æ„) - æ•´ä½“æ¶æ„è®¾è®¡
- [ç›®å½•ç»“æ„](#-ç›®å½•ç»“æ„) - ä»£ç ç»„ç»‡ç»“æ„
- [æ ¸å¿ƒæŠ€æœ¯](#-æ ¸å¿ƒæŠ€æœ¯) - å¹¶å‘å¤„ç†æ ¸å¿ƒç®—æ³•
- [æ€§èƒ½æŒ‡æ ‡](#-æ€§èƒ½æŒ‡æ ‡) - ç³»ç»Ÿæ€§èƒ½æ•°æ®

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

pnpm install


### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

pnpm run dev


è®¿é—®: **http://localhost:5173/**

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

pnpm run build


## âœ¨ æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | æè¿° | çŠ¶æ€ |
|------|------|------|
| å¹¶å‘å†²çªå¤„ç† | ä¼˜é›…å¤„ç†å¤šç”¨æˆ·åŒæ—¶é¢„å®š | âœ… |
| ä¹è§‚æ›´æ–° | UIç«‹å³åé¦ˆï¼Œåç«¯ç¡®è®¤ | âœ… |
| å®æ—¶çŠ¶æ€åŒæ­¥ | WebSocketå¤šç”¨æˆ·åŒæ­¥ | âœ… |
| è·¨é¡µç­¾åŒæ­¥ | BroadcastChannel + localStorage è·¨é¡µç­¾æ•°æ®åŒæ­¥ | âœ… |
| å…¨å±€é”æœºåˆ¶ | é˜²æ­¢è·¨é¡µç­¾å¹¶å‘å†²çª | âœ… |
| é”å®šè¶…æ—¶ | 30ç§’è‡ªåŠ¨è§£é”æœºåˆ¶ | âœ… |
| çŠ¶æ€å›æ»š | å†²çªæ—¶è‡ªåŠ¨æ¢å¤çŠ¶æ€ | âœ… |
| æµ‹è¯•å·¥å…· | å®Œæ•´çš„å¹¶å‘æµ‹è¯•å¥—ä»¶ï¼ˆå«è·¨é¡µç­¾æµ‹è¯•ï¼‰ | âœ… |

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Frontend (React)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   MobX Store â”‚  â”‚ WebSocket    â”‚  â”‚   Material-UI    â”‚  â”‚
â”‚  â”‚              â”‚  â”‚   Service    â”‚  â”‚   Components     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Mock API Service                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     BookingAPI (æ¨¡æ‹Ÿå¹¶å‘å†²çªå’ŒçŠ¶æ€ç®¡ç†)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶æ„è¯´æ˜**:
- **å‰ç«¯å±‚**: React + MobXè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼ŒWebSocketå®ç°å®æ—¶åŒæ­¥
- **å…¨å±€çŠ¶æ€å±‚**: GlobalEventBusæä¾›è·¨é¡µç­¾æ•°æ®åŒæ­¥èƒ½åŠ›
- **UIå±‚**: Material-UIæä¾›å“åº”å¼ç»„ä»¶
- **æœåŠ¡å±‚**: Mock APIæ¨¡æ‹Ÿåç«¯è¡Œä¸ºå’Œå¹¶å‘å†²çª

### ğŸŒ è·¨é¡µç­¾åŒæ­¥æœºåˆ¶

**é—®é¢˜åœºæ™¯**: å¤šä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µåŒæ—¶è®¿é—®ç³»ç»Ÿï¼Œéœ€è¦é¿å…å¹¶å‘å†²çª

**è§£å†³æ–¹æ¡ˆ**:
```
æ ‡ç­¾é¡µA: å°è¯•é¢„å®š slot-1 â†’ è·å–å…¨å±€é” â†’ æˆåŠŸ
æ ‡ç­¾é¡µB: å°è¯•é¢„å®š slot-1 â†’ æ£€æµ‹åˆ°å…¨å±€é” â†’ å¤±è´¥æç¤º
```

**å®ç°æ–¹å¼**:
1. **GlobalEventBus**: åŸºäº BroadcastChannel + localStorage çš„äº‹ä»¶æ€»çº¿
2. **å…¨å±€é”ç®¡ç†**: ä½¿ç”¨ localStorage å­˜å‚¨è·¨é¡µç­¾é”çŠ¶æ€
3. **é”è¶…æ—¶æœºåˆ¶**: 30ç§’è‡ªåŠ¨æ¸…ç†è¿‡æœŸé”
4. **äº‹ä»¶å¹¿æ’­**: é”çŠ¶æ€å˜åŒ–å®æ—¶å¹¿æ’­åˆ°æ‰€æœ‰æ ‡ç­¾é¡µ

**æ ¸å¿ƒä»£ç **:
```typescript
// è·å–å…¨å±€é”
const acquired = globalEventBus.acquireLock(slotId, userId)
if (!acquired) {
  return { success: false, error: 'å·²è¢«å…¶ä»–é¡µç­¾é”å®š' }
}
```

### ğŸ”„ çŠ¶æ€æœºè®¾è®¡

**æ—¶é—´æ®µçŠ¶æ€æµè½¬**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ç”¨æˆ·ç‚¹å‡»é¢„å®š     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AVAILABLE  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚    LOCKED    â”‚
â”‚   (å¯ç”¨)     â”‚                     â”‚   (é”å®šä¸­)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                    â”‚
       â”‚ é¢„å®šæˆåŠŸ/ç¡®è®¤          â”‚ é¢„å®šå¤±è´¥/è¶…æ—¶ â”‚
       â”‚                      â”‚              â”‚
       â†“                      â”‚              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BOOKED     â”‚             â”‚        â”‚   AVAILABLE  â”‚
â”‚  (å·²é¢„å®š)     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   (å›æ»š)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®è®¾è®¡ç‚¹**:
1. **é”å®šæœºåˆ¶**: é˜²æ­¢åŒä¸€æ—¶é—´æ®µè¢«å¤šæ¬¡é¢„å®š
2. **è¶…æ—¶æœºåˆ¶**: 30ç§’è‡ªåŠ¨è§£é”ï¼Œé¿å…æ­»é”
3. **ä¹è§‚æ›´æ–°**: UIç«‹å³å“åº”ï¼Œåç«¯ç¡®è®¤åæ›´æ–°
4. **çŠ¶æ€å›æ»š**: å¤±è´¥æ—¶è‡ªåŠ¨æ¢å¤åˆ°åŸå§‹çŠ¶æ€

### ğŸ“¦ åˆ†å±‚æ¶æ„

**1. è¡¨ç°å±‚ (Presentation Layer)**
- Reactç»„ä»¶æ¸²æŸ“
- Material-UIæ ·å¼ç³»ç»Ÿ
- ç”¨æˆ·äº¤äº’å¤„ç†

**2. çŠ¶æ€ç®¡ç†å±‚ (State Management Layer)**
- MobXå“åº”å¼çŠ¶æ€ç®¡ç†
- ä¹è§‚æ›´æ–°é€»è¾‘
- å¹¶å‘å†²çªæ£€æµ‹

**3. æœåŠ¡å±‚ (Service Layer)**
- BookingAPI: ä¸šåŠ¡é€»è¾‘å¤„ç†
- WebSocketService: å®æ—¶é€šä¿¡
- å¹¶å‘æ§åˆ¶æœºåˆ¶

**4. æ•°æ®å±‚ (Data Layer)**
- TypeScriptç±»å‹å®šä¹‰
- æ•°æ®éªŒè¯å’Œè½¬æ¢
- çŠ¶æ€æŒä¹…åŒ–

### ğŸ¯ è®¾è®¡æ¨¡å¼

**1. è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)**
```typescript
// WebSocketäº‹ä»¶ç›‘å¬
this.wsService.onSlotUpdate((slot) => {
  // è‡ªåŠ¨æ›´æ–°UI
})
```

**2. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)**
```typescript
// æ ¹æ®ä¸åŒé”™è¯¯ç±»å‹é‡‡å–ä¸åŒå¤„ç†ç­–ç•¥
switch (error.code) {
  case ApiErrorCode.CONFLICT_DETECTED:
    this.handleConflict()
    break
  case ApiErrorCode.TIMESTAMP_EXPIRED:
    this.handleTimeout()
    break
}
```

**3. å¤‡å¿˜å½•æ¨¡å¼ (Memento Pattern)**
```typescript
// ä¿å­˜åŸå§‹çŠ¶æ€ç”¨äºå›æ»š
this.clientState.optimisticUpdates.set(slotId, originalSlot)
```

## ğŸ“ ç›®å½•ç»“æ„

```
booking/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/              # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ TimeSlotCard.tsx         # æ—¶é—´æ®µå¡ç‰‡ç»„ä»¶
â”‚   â”‚   â””â”€â”€ TimeSlotGrid.tsx         # æ—¶é—´æ®µç½‘æ ¼å¸ƒå±€
â”‚   â”œâ”€â”€ stores/                  # MobXçŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ BookingStore.ts          # é¢„å®šçŠ¶æ€ç®¡ç†æ ¸å¿ƒ
â”‚   â”œâ”€â”€ services/                # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ BookingAPI.ts            # APIæœåŠ¡(æ¨¡æ‹Ÿåç«¯)
â”‚   â”‚   â””â”€â”€ WebSocketService.ts      # WebSocketå®æ—¶åŒæ­¥
â”‚   â”œâ”€â”€ types/                   # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts                 # æ ¸å¿ƒTypeScriptç±»å‹
â”‚   â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ ConcurrencyTester.ts     # å¹¶å‘æµ‹è¯•å·¥å…·
â”‚   â”œâ”€â”€ demo/                    # æµ‹è¯•æ¼”ç¤º
â”‚   â”‚   â””â”€â”€ ConcurrencyDemo.tsx      # äº¤äº’å¼æµ‹è¯•ç•Œé¢
â”‚   â””â”€â”€ App.tsx                  # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ HIGH_CONCURRENCY_BOOKING_SYSTEM.md  # è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ PROJECT_SUMMARY.md                # é¡¹ç›®æ€»ç»“
â”œâ”€â”€ ESLINT_CONFIG.md                  # ESLinté…ç½®è¯´æ˜
â””â”€â”€ README.md                         # é¡¹ç›®ç´¢å¼•(æœ¬æ–‡ä»¶)
```

## ğŸ¬ ä½¿ç”¨æ¼”ç¤º

### 1. åŸºç¡€ä½¿ç”¨
1. æ‰“å¼€ http://localhost:5173/
2. è¾“å…¥ç”¨æˆ·åå¹¶ç¡®è®¤
3. æµè§ˆå¯ç”¨æ—¶é—´æ®µ
4. ç‚¹å‡»"ç«‹å³é¢„å®š"
5. è§‚å¯ŸçŠ¶æ€å˜åŒ–

### 2. å¹¶å‘æµ‹è¯•
æ‰“å¼€å¤šä¸ªæµè§ˆå™¨çª—å£ï¼Œæ¨¡æ‹Ÿå¤šç”¨æˆ·åŒæ—¶é¢„å®šï¼š
- ç”¨æˆ·Aå’Œç”¨æˆ·BåŒæ—¶ç‚¹å‡»åŒä¸€æ—¶é—´æ®µ
- è§‚å¯Ÿå¹¶å‘å†²çªå¤„ç†
- éªŒè¯çŠ¶æ€å›æ»šæœºåˆ¶

### 3. æµ‹è¯•å·¥å…·
è®¿é—® /demo è·¯å¾„ä½¿ç”¨äº¤äº’å¼æµ‹è¯•å·¥å…·ï¼š
- å¹¶å‘é¢„å®šæµ‹è¯•
- å¿«é€Ÿé¢„å®šæµ‹è¯•
- é”å®šè¶…æ—¶æµ‹è¯•
- **è·¨é¡µç­¾å¹¶å‘æµ‹è¯•** (æ–°å¢)
- **å…¨å±€é”æœºåˆ¶æµ‹è¯•** (æ–°å¢)
- å®Œæ•´æµ‹è¯•å¥—ä»¶

### 4. è·¨é¡µç­¾æµ‹è¯•æ¼”ç¤º
æ‰“å¼€å¤šä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µï¼Œè®¿é—® http://localhost:5173/demoï¼š

**æµ‹è¯•æ­¥éª¤**:
1. åœ¨æ ‡ç­¾é¡µAä¸­ç‚¹å‡»"è·¨é¡µç­¾å¹¶å‘é¢„å®šæµ‹è¯•"
2. åœ¨æ ‡ç­¾é¡µBä¸­ç‚¹å‡»"æµ‹è¯•å…¨å±€é”æœºåˆ¶"
3. è§‚å¯Ÿå…¨å±€é”çŠ¶æ€æ˜¾ç¤º
4. éªŒè¯è·¨é¡µç­¾æ•°æ®åŒæ­¥æ•ˆæœ

**é¢„æœŸç»“æœ**:
- åªæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚èƒ½è·å–å…¨å±€é”
- å…¶ä»–è¯·æ±‚æ”¶åˆ°"å·²è¢«é”å®š"æç¤º
- é”çŠ¶æ€å®æ—¶åŒæ­¥åˆ°æ‰€æœ‰æ ‡ç­¾é¡µ

## ğŸ” æ ¸å¿ƒæŠ€æœ¯

### ğŸ’¡ ç³»ç»Ÿè®¾è®¡åŸç†

#### 1. é˜²æ­¢å¹¶å‘å†²çªæœºåˆ¶

**é—®é¢˜åœºæ™¯**: å¤šä¸ªç”¨æˆ·åŒæ—¶ç‚¹å‡»åŒä¸€æ—¶é—´æ®µè¿›è¡Œé¢„å®š

**è§£å†³æ–¹æ¡ˆ**:
```
ç”¨æˆ·Aç‚¹å‡» â†’ é”å®šæ—¶é—´æ®µ â†’ å‘é€è¯·æ±‚ â†’ é¢„å®šæˆåŠŸ
ç”¨æˆ·Bç‚¹å‡» â†’ ç­‰å¾…/å›æ»š â†’ æ˜¾ç¤ºå†²çªä¿¡æ¯
```

**å®ç°ä»£ç **:
```typescript
// BookingStoreä¸­çš„å¹¶å‘å¤„ç†é€»è¾‘
if (slot.status === SlotStatus.BOOKED) {
  return {
    success: false,
    conflict: {
      bookedBy: slot.bookedBy,
      bookedAt: slot.bookedAt
    }
  }
}
```

#### 2. çŠ¶æ€åŒæ­¥æœºåˆ¶

**å®æ—¶åŒæ­¥**: ä½¿ç”¨WebSocketå®ç°å¤šç”¨æˆ·çŠ¶æ€å®æ—¶åŒæ­¥
```typescript
// WebSocketæ¶ˆæ¯å¤„ç†
this.wsService.onSlotUpdate((updatedSlot: TimeSlot) => {
  runInAction(() => {
    this.slots.set(updatedSlot.id, updatedSlot)
  })
})
```

**é™çº§æ–¹æ¡ˆ**: WebSocketè¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°æœ¬åœ°çŠ¶æ€ç®¡ç†

#### 5. è·¨é¡µç­¾å…¨å±€é”æœºåˆ¶

**æ ¸å¿ƒæ€æƒ³**: ä½¿ç”¨å…¨å±€äº‹ä»¶æ€»çº¿ç®¡ç†è·¨é¡µç­¾é”çŠ¶æ€ï¼Œé˜²æ­¢å¹¶å‘å†²çª

**å®ç°ä»£ç **:
```typescript
// GlobalEventBus æ ¸å¿ƒæ–¹æ³•
acquireLock(slotId: string, userId: string): boolean {
  const locks = this.getLocks()
  const existing = locks[slotId]

  // æ£€æŸ¥æ˜¯å¦è¢«å…¶ä»–ç”¨æˆ·é”å®š
  if (existing && existing.userId !== userId) {
    return false
  }

  // è·å–é”å¹¶å¹¿æ’­
  locks[slotId] = { userId, lockedAt: new Date().toISOString() }
  localStorage.setItem(this.LOCK_KEY, JSON.stringify(locks))
  this.emit('lock_acquired', { slotId, userId })
  return true
}
```

**å…³é”®ç‰¹æ€§**:
- 30ç§’é”è¶…æ—¶è‡ªåŠ¨æ¸…ç†
- å®æ—¶é”çŠ¶æ€å¹¿æ’­åˆ°æ‰€æœ‰é¡µç­¾
- æ”¯æŒ WebSocket é™çº§åˆ°æœ¬åœ°åŒæ­¥

#### 3. ä¹è§‚UIæ›´æ–°æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**: ç”¨æˆ·æ“ä½œç«‹å³åæ˜ åœ¨UIä¸Šï¼Œåç«¯ç¡®è®¤åæ›´æ–°çŠ¶æ€

**æµç¨‹å›¾**:
```
1. ç”¨æˆ·ç‚¹å‡»é¢„å®š
   â†“
2. ç«‹å³æ›´æ–°UIä¸º"é”å®šä¸­"
   â†“
3. å‘é€è¯·æ±‚åˆ°åç«¯
   â†“
4. åç«¯å“åº”ï¼š
   â”œâ”€ æˆåŠŸ â†’ æ›´æ–°ä¸º"å·²é¢„å®š"
   â””â”€ å¤±è´¥ â†’ å›æ»šåˆ°"å¯ç”¨"
```

**å®ç°ä»£ç **:
```typescript
// 1. ç«‹å³æ›´æ–°UI
applyOptimisticUpdate(slotId, optimisticSlot)

// 2. å‘é€è¯·æ±‚
const response = await api.bookSlot(request)

// 3. ç¡®è®¤æˆ–å›æ»š
if (response.success) {
  confirmBooking(response.slot)
} else {
  rollbackToOriginal(slotId)
}
```

#### 4. æ™ºèƒ½å›æ»šæœºåˆ¶

**è§¦å‘æ¡ä»¶**:
- ç½‘ç»œè¯·æ±‚å¤±è´¥
- å¹¶å‘å†²çªæ£€æµ‹
- é”å®šè¶…æ—¶ï¼ˆ30ç§’ï¼‰

**å›æ»šç­–ç•¥**:
```typescript
private handleBookingFailure(slotId: string, response: BookingResponse) {
  const originalSlot = this.clientState.optimisticUpdates.get(slotId)

  if (originalSlot) {
    // å›æ»šåˆ°åŸå§‹çŠ¶æ€
    this.slots.set(slotId, originalSlot)
    this.clearOptimisticUpdate(slotId)
  }
}
```

**è¶…æ—¶å›æ»š**:
```typescript
setTimeout(() => {
  const pending = this.clientState.pendingBookings.get(slotId)
  if (pending && pending.status === 'pending') {
    this.handleBookingTimeout(slotId)
  }
}, this.config.maxPendingTime)
```

### ä¹è§‚æ›´æ–°æ¨¡å¼

```typescript
// 1. ç«‹å³æ›´æ–°UI
applyOptimisticUpdate(slotId, optimisticSlot)

// 2. å‘é€è¯·æ±‚
const response = await api.bookSlot(request)

// 3. ç¡®è®¤æˆ–å›æ»š
if (response.success) {
  confirmBooking(response.slot)
} else {
  rollbackToOriginal(slotId)
}
```

### å¹¶å‘å†²çªæ£€æµ‹

```typescript
if (slot.status === SlotStatus.BOOKED) {
  return {
    success: false,
    conflict: {
      bookedBy: slot.bookedBy,
      bookedAt: slot.bookedAt
    }
  }
}
```

### é”å®šè¶…æ—¶æœºåˆ¶

```typescript
setTimeout(() => {
  if (pending.status === 'pending') {
    rollbackToAvailable(slotId)
  }
}, LOCK_TIMEOUT) // 30ç§’
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **æ„å»ºå¤§å°**: ~553KB (gzipped: ~170KB)
- **é¦–æ¬¡åŠ è½½**: < 1ç§’
- **å“åº”æ—¶é—´**: < 100ms
- **å¹¶å‘æ”¯æŒ**: 20+ ç”¨æˆ·åŒæ—¶é¢„å®š
- **å†…å­˜ä½¿ç”¨**: < 50MB

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 19.2 | å‰ç«¯æ¡†æ¶ |
| MobX | 6.15 | çŠ¶æ€ç®¡ç† |
| Material-UI | 6.5 | UIç»„ä»¶åº“ |
| TypeScript | 5.9 | ç±»å‹å®‰å…¨ |
| Vite | 7.3 | æ„å»ºå·¥å…· |
| date-fns | 4.1 | æ—¥æœŸå¤„ç† |

## ğŸ“ˆ æµè§ˆå™¨æ”¯æŒ

- Chrome >= 90
- Firefox >= 90
- Safari >= 14
- Edge >= 90

## ğŸ“ å­¦ä¹ èµ„æº

### æ¨èé˜…è¯»
- [MobXå®˜æ–¹æ–‡æ¡£](https://mobx.js.org/)
- [Material-UIæŒ‡å—](https://mui.com/)
- [Reactå¹¶å‘æ¨¡å¼](https://react.dev/learn/concurrent-ui-patterns)
- [WebSocketæœ€ä½³å®è·µ](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API)

### ç›¸å…³é¡¹ç›®
- [ReactçŠ¶æ€ç®¡ç†å¯¹æ¯”](https://github.com/reactjs/react-redux)
- [å®æ—¶åº”ç”¨æ¶æ„](https://socket.io/)

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œå±•ç¤ºäº†é«˜å¹¶å‘åœºæ™¯ä¸‹çš„å‰ç«¯è§£å†³æ–¹æ¡ˆã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚
